<?
/*
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#
#          _ ___               _						 #
#         (_)__ \             | |    						 #
# ___  ___ _   ) |_      _____| |__  						 #
#/ __|/ __| | / /\ \ /\ / / _ \ '_ \ 						 #
#\__ \ (__| |/ /_ \ V  V /  __/ |_) |						 #
#|___/\___|_|____| \_/\_/ \___|_.__/ 						 #
#JORGE ZULUAGA (C) 2011  							 #
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
# WEB PAGE
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
*/
//////////////////////////////////////////////////////////////////////////////////
//LOAD PACKAGE
//////////////////////////////////////////////////////////////////////////////////
$RELATIVE=".";
$PAGETITLE="Sci2Web Main page";
include("$RELATIVE/lib/sci2web.php");

//////////////////////////////////////////////////////////////////////////////////
//CHECK LOGIN
//////////////////////////////////////////////////////////////////////////////////
checkAuthentication();

//////////////////////////////////////////////////////////////////////////////////
//PARTICULAR CONFIGURATION
//////////////////////////////////////////////////////////////////////////////////
$cpath="$PROJ[PAGESPATH]/$PHP[PAGEBASENAME]";
$cdir="$PROJ[PAGESDIR]/$PHP[PAGEBASENAME]";
require_once("$cpath/page.conf");
if(!isset($PHP["TabId"])) $PHP["TabId"]=$DEFTAB-1;
else $PHP["TabId"]--;
if(!isset($_SESSION["User"])){
  $PHP["TabId"]=0;
}

//////////////////////////////////////////////////////////////////////////////////
//COMPONENTS
//////////////////////////////////////////////////////////////////////////////////
//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
//PERLIMINARIES
//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
$head="";
$head.=genHead("","");

//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
//HEADER
//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
$header=genHeader($PAGELOGO);

//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
//BODY DECLARATION
//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
$body="";
$body.=<<<BODY
<body>
BODY;

//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
//CONTENT
//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
$content="";

//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
//FOOTER
//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
$footer="";
$footer.=genFooter();

//////////////////////////////////////////////////////////////////////////////////
//GENERATE CONTENT
//////////////////////////////////////////////////////////////////////////////////
$DEBUG=genDebug();
echo<<<CONTENT
<html>
<head>
$head
</head>
$body
<!-- ---------------------------------------------------------------------- -->
<!-- HEADER								    -->
<!-- ---------------------------------------------------------------------- -->
$header
<!-- ---------------------------------------------------------------------- -->
<!-- CONTENT								    -->
<!-- ---------------------------------------------------------------------- -->
<div class="tabber maintabber" id="$PHP[TabId]">
  $DEBUG

CONTENT;

//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
//GET LIST OF FILES
//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
$files=listFiles($cpath,"*.php");
if(count($files)==0){
echo<<<CONTENT
  <div class="tabbertab" id="maintab">
  <h2>Blank</h2>
  </div>

CONTENT;
}
//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
//DISPLAY THE CONTENT OF EACH FILE
//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
$i=1;
foreach($files as $file)
{
  if(isBlank($file)) continue;

  //GET INDEX VALUE
  $fcontent=systemCmd("head -n 1 $cpath/$file");
  preg_match("/<!--\s*(.+)\s*-->/",$fcontent,$matches);
  $fid=$matches[1];
  if(isBlank($fid)) $fid="tab$i";

  //LOAD THE CONTENT
  $imgload=genLoadImg("animated/loader-circle.gif");
$ajaxcmd=<<<AJAX
loadContent
  (
   '$cdir/$file?$PHP[QSTRING]',
   '$fid',
   function(element,rtext){
     $(element).html(rtext);
     $(element).css('text-align','left');
   },
   function(element,rtext){
     $(element).html('$imgload');
     $(element).css('text-align','center');
   },
   null,
   -1,
   true
   )
AJAX;
   blankFunc();
   $onload=genOnLoad($ajaxcmd,'load');
   //echo "<textarea>$onload</textarea>";br();
   //exit(0);

   //BUILT THE CONTENT
echo <<<CONTENT
  $onload
  <div class="tabbertab maintab">
  <h2>$fid</h2>
  <div class="tabcontent" id="$fid"></div>
  </div>
CONTENT;
  $i++;
}
echo<<<CONTENT
</div>
$footer
</body>
</html>

CONTENT;
//////////////////////////////////////////////////////////////////////////////////
//FINALIZE
//////////////////////////////////////////////////////////////////////////////////
finalizePage();
?>
